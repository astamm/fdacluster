<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Analysis of Berkeley growth data ‚Ä¢ fdacluster</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Analysis of Berkeley growth data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">fdacluster</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.3.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/berkeley-growth.html">Analysis of Berkeley growth data</a></li>
    <li><a class="dropdown-item" href="../articles/hierarchial-clustering.html">Hierarchical clustering</a></li>
    <li><a class="dropdown-item" href="../articles/input-formats.html">Supported input formats</a></li>
    <li><a class="dropdown-item" href="../articles/kmeans-initialisation.html">Computing initial centroids in k-means</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://astamm.github.io/posts/2023-07-04-fdacluster-030/">fdacluster 0.3.0</a></li>
    <li><a class="external-link dropdown-item" href="https://astamm.github.io/posts/2023-05-19-fdacluster-021/">fdacluster 0.2.1</a></li>
    <li><a class="external-link dropdown-item" href="https://astamm.github.io/posts/2022-05-10-fdacluster-011/">fdacluster 0.1.1</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-talks" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Talks</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-talks">
<li><a class="external-link dropdown-item" href="https://astamm.github.io/talks/2023-06-22-fdacluster-021/">Rencontres R 2023</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/astamm/fdacluster/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Analysis of Berkeley growth data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/astamm/fdacluster/blob/master/vignettes/berkeley-growth.Rmd" class="external-link"><code>vignettes/berkeley-growth.Rmd</code></a></small>
      <div class="d-none name"><code>berkeley-growth.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="the-berkeley-growth-data">The Berkeley growth data<a class="anchor" aria-label="anchor" href="#the-berkeley-growth-data"></a>
</h2>
<p>A total of 93 children (39 boys and 54 girls) have been followed on
which the height in cm has been measured over time on a common grid of
age:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">growth</span> <span class="op">&lt;-</span> <span class="fu">fda</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/fda/man/growth.html" class="external-link">growth</a></span></span>
<span><span class="va">mb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"male"</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">growth</span><span class="op">$</span><span class="va">hgtm</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>, </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="st">"female"</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">growth</span><span class="op">$</span><span class="va">hgtf</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">mb</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="va">growth</span><span class="op">$</span><span class="va">age</span></span>
<span><span class="va">M</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span></span>
<span><span class="va">y0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">growth</span><span class="op">$</span><span class="va">hgtm</span>, <span class="va">growth</span><span class="op">$</span><span class="va">hgtf</span><span class="op">)</span></span>
<span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  Age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">x</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  Height <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/array-coercion.html" class="external-link">array_tree</a></span><span class="op">(</span><span class="va">y0</span>, margin <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  Gender <span class="op">=</span> <span class="va">mb</span>,</span>
<span>  CurveID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">unnest</span><span class="op">(</span><span class="va">Age</span>, <span class="va">Height</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">Age</span>, <span class="va">Height</span>, color <span class="op">=</span> <span class="va">Gender</span>, group <span class="op">=</span> <span class="va">CurveID</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Heights of 39 boys and 54 girls from age 1 to 18"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Age (years)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Height (cm)"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="berkeley-growth_files/figure-html/unnamed-chunk-1-1.png" width="672"></p>
<p>A single observation is actually a time series
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ùê±</mi><mi>i</mi></msub><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mn>1</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo><mi>‚Ä¶</mi><mo>,</mo><msub><mi>x</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>M</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mi>‚ä§</mi></msup></mrow><annotation encoding="application/x-tex">\mathbf{x}_i = (x_i(t_1), \dots,
x_i(t_M))^\top</annotation></semantics></math>. We can hypothesize that
we know what happened between any two consecutive points
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mi>j</mi></msub><annotation encoding="application/x-tex">t_j</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>t</mi><mrow><mi>j</mi><mo>+</mo><mn>1</mn></mrow></msub><annotation encoding="application/x-tex">t_{j+1}</annotation></semantics></math>
even though we did not observe the data in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>j</mi></msub><mo>,</mo><msub><mi>t</mi><mrow><mi>j</mi><mo>+</mo><mn>1</mn></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(t_j, t_{j+1})</annotation></semantics></math>.
This is usually achieved via splines or Fourier or wavelet basis
decomposition to confer the observation with some degree of regularity
and to account for possible periodicity or other specificity of the data
point. This step of <em>data representation</em> effectively transforms
the original observation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>ùê±</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\mathbf{x}_i</annotation></semantics></math>
which was a time series into a functional data point
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub><mo>:</mo><mi>ùíü</mi><mo>‚Üí</mo><mi>‚Ñ≥</mi></mrow><annotation encoding="application/x-tex">x_i :
\mathcal{D} \to \mathcal{M}</annotation></semantics></math>.</p>
</div>
<div class="section level2">
<h2 id="functional-data-representation">Functional data representation<a class="anchor" aria-label="anchor" href="#functional-data-representation"></a>
</h2>
<p>Given an orthonormal basis
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><msub><mi>e</mi><mi>b</mi></msub><msub><mo stretchy="false" form="postfix">}</mo><mrow><mi>b</mi><mo>‚â•</mo><mn>1</mn></mrow></msub></mrow><annotation encoding="application/x-tex">\{e_b\}_{b\ge 1}</annotation></semantics></math>
of the functional space which observations are assumed to belong to, we
can model observation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>x</mi><mi>i</mi></msub><annotation encoding="application/x-tex">x_i</annotation></semantics></math>
as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>x</mi><mi>i</mi></msub><mo>=</mo><msub><mi>f</mi><mi>i</mi></msub><mo>+</mo><msub><mi>Œµ</mi><mi>i</mi></msub><mo>,</mo></mrow><annotation encoding="application/x-tex">
x_i = f_i + \varepsilon_i,
</annotation></semantics></math> where:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>f</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><munderover><mo>‚àë</mo><mrow><mi>b</mi><mo>=</mo><mn>1</mn></mrow><mi>B</mi></munderover><msub><mi>f</mi><mrow><mi>i</mi><mi>b</mi></mrow></msub><msub><mi>e</mi><mi>b</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>t</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
f_i(t) = \sum_{b=1}^B f_{ib} e_b(t),
</annotation></semantics></math> for some truncation
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>B</mi><annotation encoding="application/x-tex">B</annotation></semantics></math>.
The coefficients
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>f</mi><mrow><mi>i</mi><mi>b</mi></mrow></msub><annotation encoding="application/x-tex">f_{ib}</annotation></semantics></math>
are then adjusted by minimizing a cost function that usually includes
the data attachment term and a rougness penalty term as a way to enforce
some regularity into the functional representation. It is common to use
for instance the norm of the second derivative as roughness penalty, in
which case the cost function becomes:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><munderover><mo>‚àë</mo><mrow><mi>m</mi><mo>=</mo><mn>1</mn></mrow><mi>M</mi></munderover><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>x</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>m</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>‚àí</mo><msub><mi>f</mi><mi>i</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>m</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup><mo>+</mo><mi>Œª</mi><munderover><mo>‚àë</mo><mrow><mi>m</mi><mo>=</mo><mn>1</mn></mrow><mi>M</mi></munderover><msup><mrow><mo stretchy="true" form="prefix">[</mo><msubsup><mi>f</mi><mi>i</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></msubsup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>t</mi><mi>m</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">
\sum_{m=1}^M \left( x_i(t_m) - f_i(t_m) \right)^2 + \lambda \sum_{m=1}^M \left[ f_i^{(2)}(t_m) \right]^2
</annotation></semantics></math></p>
<p>In practice, such a functional representation can be achieved in R
using the <strong>fda</strong> package. The following code adjusts a
B-spline representation to the growth curves where the weight
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Œª</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
of the roughness penalty is determined by minimizing the generalized
cross-validation criterion:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">basisobj</span> <span class="op">&lt;-</span> <span class="fu">fda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fda/man/create.bspline.basis.html" class="external-link">create.bspline.basis</a></span><span class="op">(</span>rangeval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/range.html" class="external-link">range</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, nbasis <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span>
<span><span class="va">fd_vals</span> <span class="op">&lt;-</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">N</span>, \<span class="op">(</span><span class="va">n</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">yobs</span> <span class="op">&lt;-</span> <span class="va">y0</span><span class="op">[</span>, <span class="va">n</span><span class="op">]</span></span>
<span>  <span class="va">result</span> <span class="op">&lt;-</span> <span class="fu">fda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fda/man/smooth.basis.html" class="external-link">smooth.basis</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">yobs</span>, <span class="va">basisobj</span><span class="op">)</span></span>
<span>  <span class="va">yfd</span> <span class="op">&lt;-</span> <span class="va">result</span><span class="op">$</span><span class="va">fd</span></span>
<span>  <span class="va">cost</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lam</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">yfdPar</span> <span class="op">&lt;-</span> <span class="fu">fda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fda/man/fdPar.html" class="external-link">fdPar</a></span><span class="op">(</span><span class="va">yfd</span>, <span class="fl">2</span>, <span class="va">lam</span><span class="op">)</span></span>
<span>    <span class="va">out</span> <span class="op">&lt;-</span> <span class="fu">fda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fda/man/smooth.basis.html" class="external-link">smooth.basis</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">yobs</span>, <span class="va">yfdPar</span><span class="op">)</span></span>
<span>    <span class="va">out</span><span class="op">$</span><span class="va">gcv</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">lambda_opt</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/optimize.html" class="external-link">optimise</a></span><span class="op">(</span><span class="va">cost</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1e-8</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">$</span><span class="va">minimum</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">lambda_opt</span> <span class="op">&lt;=</span> <span class="fl">1e-8</span><span class="op">)</span></span>
<span>    <span class="fu">cli</span><span class="fu">::</span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_alert.html" class="external-link">cli_alert_warning</a></span><span class="op">(</span><span class="st">"The optimal penalty has reached the lower bound (1e-8) for curve #{n}."</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">lambda_opt</span> <span class="op">&gt;=</span> <span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="fu">cli</span><span class="fu">::</span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_alert.html" class="external-link">cli_alert_warning</a></span><span class="op">(</span><span class="st">"The optimal penalty has reached the upper bound (1) for curve #{n}."</span><span class="op">)</span></span>
<span>  <span class="va">yfdPar</span> <span class="op">&lt;-</span> <span class="fu">fda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fda/man/fdPar.html" class="external-link">fdPar</a></span><span class="op">(</span><span class="va">yfd</span>, <span class="fl">2</span>, <span class="va">lambda_opt</span><span class="op">)</span></span>
<span>  <span class="fu">fda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fda/man/smooth.fd.html" class="external-link">smooth.fd</a></span><span class="op">(</span><span class="va">yfd</span>, <span class="va">yfdPar</span><span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span><span class="va">fd</span> <span class="op">&lt;-</span> <span class="fu">fda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fda/man/fd.html" class="external-link">fd</a></span><span class="op">(</span></span>
<span>  coef <span class="op">=</span> <span class="va">fd_vals</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="st">"coefs"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>    <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/reduce.html" class="external-link">reduce</a></span><span class="op">(</span><span class="va">cbind</span><span class="op">)</span>,</span>
<span>  basisobj <span class="op">=</span> <span class="va">basisobj</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>We can now take a look of the data under this representation:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y0</span> <span class="op">&lt;-</span> <span class="fu">fda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fda/man/eval.fd.html" class="external-link">eval.fd</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">fd</span>, <span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  Age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">x</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  Height <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/array-coercion.html" class="external-link">array_tree</a></span><span class="op">(</span><span class="va">y0</span>, margin <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  Gender <span class="op">=</span> <span class="va">mb</span>,</span>
<span>  CurveID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">unnest</span><span class="op">(</span><span class="va">Age</span>, <span class="va">Height</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">Age</span>, <span class="va">Height</span>, color <span class="op">=</span> <span class="va">Gender</span>, group <span class="op">=</span> <span class="va">CurveID</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Heights of 39 boys and 54 girls from age 1 to 18"</span>, </span>
<span>    x <span class="op">=</span> <span class="st">"Age (years)"</span>, </span>
<span>    y <span class="op">=</span> <span class="st">"Height (cm)"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="berkeley-growth_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
<p>We can also compute and display the growth rate:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y1</span> <span class="op">&lt;-</span> <span class="fu">fda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/fda/man/eval.fd.html" class="external-link">eval.fd</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">fd</span>, <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  Age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">replicate</a></span><span class="op">(</span><span class="va">N</span>, <span class="va">x</span>, simplify <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  Height <span class="op">=</span> <span class="fu">purrr</span><span class="fu">::</span><span class="fu"><a href="https://purrr.tidyverse.org/reference/array-coercion.html" class="external-link">array_tree</a></span><span class="op">(</span><span class="va">y1</span>, margin <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  Gender <span class="op">=</span> <span class="va">mb</span>,</span>
<span>  CurveID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">N</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">unnest</span><span class="op">(</span><span class="va">Age</span>, <span class="va">Height</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span><span class="va">Age</span>, <span class="va">Height</span>, color <span class="op">=</span> <span class="va">Gender</span>, group <span class="op">=</span> <span class="va">CurveID</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_bw</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Growth velocity of 39 boys and 54 girls from age 1 to 18"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"Age (years)"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"Growth velocity (cm/year)"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p><img src="berkeley-growth_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<p>This graph is interesting because it tells us that</p>
<ul>
<li>there is a first peak of growth velocity common to boys and girls
early in age, just after birth;</li>
<li>there is a second peak of growth velocity corresponding to puberty
that happens earlier for girls;</li>
<li>the variability of this second peak is due to gender and also
inter-subject variability.</li>
</ul>
<p>In particular, if one wanted to perform clustering of these curves to
label boys and girls (assuming we did not have such an information),
then the above figures show that the best chance we have to accomplish
such a clustering is by performing a joint alignment and clustering of
the growth velocity curves so that we can simultaneously (i) minimize
within-group phase variability and (ii) cluster curves based on that
same phase variability.</p>
</div>
<div class="section level2">
<h2 id="clustering">Clustering<a class="anchor" aria-label="anchor" href="#clustering"></a>
</h2>
<p>Initial visualization and data representation steps have revealed
that, if one aims at clustering individuals based on gender, then (s)he
should focus on:</p>
<ul>
<li>searching for 2 clusters;</li>
<li>using the growth velocity curves instead of the growth curves
themselves;</li>
<li>cluster based on phase variability;</li>
<li>perform intra-cluster alignment to separate amplitude and phase
variability.</li>
</ul>
<p>However, we still have several possible clustering methods that we
can explore to perform such a task. Namely, <a href="https://astamm.github.io/fdacluster/index.html"><strong>fdacluster</strong></a>
implements the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>-means
algorithm as well as hierarchical clustering and DBSCAN. We can compare
these different clustering strategies:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">growth_mcaps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compare_caps.html">compare_caps</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">x</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">y1</span><span class="op">)</span>,</span>
<span>  n_clusters <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  metric <span class="op">=</span> <span class="st">"normalized_l2"</span>, </span>
<span>  clustering_method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="st">"kmeans"</span>, </span>
<span>    <span class="st">"hclust-complete"</span>, </span>
<span>    <span class="st">"hclust-average"</span>, </span>
<span>    <span class="st">"hclust-single"</span>,</span>
<span>    <span class="st">"dbscan"</span></span>
<span>  <span class="op">)</span>, </span>
<span>  warping_class <span class="op">=</span> <span class="st">"affine"</span>, </span>
<span>  centroid_type <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  cluster_on_phase <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This generates an object of class <a href="https://astamm.github.io/fdacluster/reference/compare_caps.html"><code>mcaps</code></a>
which has specialized <code>S3</code> methods for both <a href="https://astamm.github.io/fdacluster/reference/plot.mcaps.html"><code>graphics::plot()</code></a>
and <a href="https://astamm.github.io/fdacluster/reference/autoplot.mcaps.html"><code>ggplot2::autoplot()</code></a>.
When called on an object of class <code>mcaps</code>, these methods gain
the optional arguments:</p>
<ul>
<li>
<code>validation_criterion</code> to choose which validation
criterion to display between distance-to-center
(<code>validation_criterion = "wss"</code>) and silhouette values
(<code>validation_criterion = "silhouette"</code>);</li>
<li>
<code>what</code> to choose whether only the mean criterion should
be displayed (<code>what = "mean"</code>) or the entire distribution
across observation in the form of a boxplot
(<code>what = "distribution"</code>).</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">growth_mcaps</span>, validation_criterion <span class="op">=</span> <span class="st">"wss"</span>, what <span class="op">=</span> <span class="st">"distribution"</span><span class="op">)</span></span></code></pre></div>
<p><img src="berkeley-growth_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<p>In terms of within-cluster distances to center (WSS), hierarchical
agglomerative clustering with average or complete linkage and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>-means
stand out.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">growth_mcaps</span>, validation_criterion <span class="op">=</span> <span class="st">"silhouette"</span>, what <span class="op">=</span> <span class="st">"distribution"</span><span class="op">)</span></span></code></pre></div>
<p><img src="berkeley-growth_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<p>In terms of individual silhouette values, DBSCAN does not appear in
the comparison because it auto-detects the number of clusters and only
found 1 cluster. Of the other methods, hierarchical agglomerative
clustering with average or complete linkage stand out.</p>
<p>We can therefore proceed with hierarchical agglomerative clustering
with complete linkage for example:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">growth_caps</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fdahclust.html">fdahclust</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">x</span>,</span>
<span>  y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">y1</span><span class="op">)</span>,</span>
<span>  n_clusters <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  metric <span class="op">=</span> <span class="st">"normalized_l2"</span>,</span>
<span>  warping_class <span class="op">=</span> <span class="st">"affine"</span>, </span>
<span>  centroid_type <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  cluster_on_phase <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This generates an object of class <a href="https://astamm.github.io/fdacluster/reference/caps.html"><code>caps</code></a>
which has specialized <code>S3</code> methods for both <a href="https://astamm.github.io/fdacluster/reference/plot.caps.html"><code>graphics::plot()</code></a>
and <a href="https://astamm.github.io/fdacluster/reference/autoplot.caps.html"><code>ggplot2::autoplot()</code></a>.
When called on an object of class <a href="https://astamm.github.io/fdacluster/reference/caps.html"><code>caps</code></a>,
these methods gain the optional argument <code>type</code> which can be
one of <code>amplitude</code> or <code>phase</code>.</p>
<p>The default is <code>type = "amplitude"</code> in which case curves
before and after alignment are shown and colored by cluster
membership:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">growth_caps</span>, type <span class="op">=</span> <span class="st">"amplitude"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in data.frame(grid = as.vector(grids), value = as.vector(unicurves), :</span></span>
<span><span class="co">#&gt; row names were found from a short variable and have been discarded</span></span>
<span><span class="co">#&gt; Warning in data.frame(grid = as.vector(grids), value = as.vector(unicurves), :</span></span>
<span><span class="co">#&gt; row names were found from a short variable and have been discarded</span></span></code></pre></div>
<p><img src="berkeley-growth_files/figure-html/unnamed-chunk-9-1.png" width="672"></p>
<p>When <code>type = "phase"</code>, the warping functions are instead
displayed which gives a sense of the phase variability in the data
<em>after</em> phase alignment. Again, they are colored by cluster
membership:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">growth_caps</span>, type <span class="op">=</span> <span class="st">"phase"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in data.frame(grid = as.vector(x$original_grids), value =</span></span>
<span><span class="co">#&gt; as.vector(x$aligned_grids), : row names were found from a short variable and</span></span>
<span><span class="co">#&gt; have been discarded</span></span></code></pre></div>
<p><img src="berkeley-growth_files/figure-html/unnamed-chunk-10-1.png" width="672"></p>
<p>It is also possible to show a visual inspection of internal cluster
validation via the <a href="https://astamm.github.io/fdacluster/reference/diagnostic_plot.html"><code>diagnostic_plot()</code></a>
function, which shows individual distance-to-center and silhouette
values, with observations ordered by decreasing value of intra-cluster
silhouette:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/diagnostic_plot.html">diagnostic_plot</a></span><span class="op">(</span><span class="va">growth_caps</span><span class="op">)</span></span></code></pre></div>
<p><img src="berkeley-growth_files/figure-html/unnamed-chunk-11-1.png" width="672"></p>
<p>Finally, we can explore the correspondence between the non-supervised
groups that we found and the actual gender distribution:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">growth_caps</span><span class="op">$</span><span class="va">memberships</span>, <span class="va">mb</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">`rownames&lt;-`</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Group 1"</span>, <span class="st">"Group 2"</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">female</th>
<th align="right">male</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Group 1</td>
<td align="right">9</td>
<td align="right">38</td>
</tr>
<tr class="even">
<td align="left">Group 2</td>
<td align="right">45</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>The second group is almost entirely composed of girls while the first
group is mainly composed of men although 23.68% of girls are present in
that group. It could be interesting to dig more into the other
characteristics of these girls which might explain why our clustering
<em>sees them</em> as boys as well as understanding why 1 boy is seen as
a girl.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Aymeric Stamm.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
